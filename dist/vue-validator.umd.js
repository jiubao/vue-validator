!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t["vue-validator"]=e()}(this,function(){"use strict";var t={events:["input"],onSuccess:function(){},onError:function(){},resultKey:"validate$pass",errorKey:"vverrors"},e=Array.isArray,r=function(t){return"string"==typeof t},n=function(t){return null!==t&&"object"==typeof t},i=function(t){return"number"==typeof t},s=function(){};function u(t){return null==t||""===t}function o(t,e,r){e="data-vv-"+e;return 2===arguments.length?t.getAttribute(e):t.setAttribute(e,r)}var a=0;var f=/^1[3456789]\d{9}$/,c=/^\d{15}$/,l=/^\d{17}[\dXx]$/,h=/^[0-9]+$/,v=/^-?\d*(\.\d+)?$/,d={required:function(t){return!u(t)},mobile:function(t){return!u(t)&&f.test(t)},regular:function(t,e){return e.test(t)},idcard:function(t){return!u(t)&&(c.test(t)||l.test(t))},number:function(t){return h.test(String(t))},decimal:function(t){return v.test(t)},max:function(t,e){return!u(t)&&Number(t)<=e},min:function(t,e){return!u(t)&&Number(t)>=e},max_length:function(t,e){return u(t)?e>=0:String(t).length<=e},min_length:function(t,e){return u(t)?e<=0:String(t).length>=e}},y=["INPUT","TEXTAREA","SELECT"],p=function(e,r,n,i,u,a,f){var c=this;this.id=e,this.el=r,o(r,"id",this.id),this.rules=n||[],this.key=i,this.vm=u,this.fails=[],this.errorTarget=f,this.pass=!1,this.onError=t.onError||s,this.onSuccess=t.onSuccess||s,this.validate(a),this._validate=function(){return c.validate()},this.bind()};p.prototype.bind=function(){var e=this;this.key?this.unwatch=this.vm.$watch(this.key,this._validate):y.indexOf(this.el.tagName)>=0&&t.events.forEach(function(t){var r,n,i;r=e.el,n=t,i=e._validate,r.addEventListener(n,i,!1)})},p.prototype.validate=function(e){var r,n=this,i=this.getValue();return this.fails=[],u(i)&&!this.rules.some(function(t){return"required"===t.key})?this.pass=!0:this.pass=!this.rules.some(function(t){var e=d[t.key](i,t.value);return e||n.fails.push(t),!e}),this.vm[t.errorKey]=function(){for(var t=arguments,e={},r=0;r<arguments.length;r++)Object.keys(t[r]).forEach(function(n){return e[n]=t[r][n]});return e}(this.vm[t.errorKey],((r={})[this.key]=this.pass?"":this.fails[0].message,r)),!1!==e&&(this.pass?this.onSuccess(this):this.onError(this)),this.vm[t.resultKey]=S.pass(this.vm),this.pass},p.prototype.getValue=function(){return this.key&&this.vm?(t=this.vm,this.key.split(".").reduce(function(t,e,r,n){return t[e]},t)):this.el.value;var t},p.prototype.destroy=function(){var e=this;this.unwatch&&this.unwatch(),this.el&&t.events.forEach(function(t){return r=e.el,n=t,i=e._validate,void r.removeEventListener(n,i,!1);var r,n,i}),this.el=this.vm=this._validate=null};var m=[];function g(t){return t?m.filter(function(e){return e.vm===t}):m}function E(t){return!g(t).some(function(t){return!t.pass})}function b(t){for(var e=m.length-1;e>=0;e--)if(String(m[e].id)===String(t))return m[e];return""}var S={add:function(e,r,n,i,s,u){m.push(new p(a++,e,r,n,i,s,u)),i[t.resultKey]=E(i)},all:g,pass:E,find:b,destroy:function t(e){if(i(e))m.splice(e,1)[0].destroy();else if(r(e))t(m.indexOf(b(e)));else if(e instanceof p)t(m.indexOf(e));else for(var n=m.length-1;n>=0;n--)e&&e!==m[n].vm||t(n)},addRule:function(t,e){d[t]=e},rules:d},k={data:function(){var e;return(e={})[t.resultKey]=!1,e[t.errorKey]={},e},beforeDestroy:function(){S.destroy(this)}},x={bind:function(t,e,r){K(t,e,r)},update:function(t,e,r){e.value!==e.oldValue&&(S.destroy(o(t,"id")),K(t,e,r))},unbind:function(t){var e=S.find(o(t,"id"));e&&e.destroy()}};function K(t,i,s){var a=[];n(i.value)?(a=i.value.rules||[],i.value.required&&a.unshift({key:"required"})):r(i.value)&&!u(i.value)&&i.value.split("|").forEach(function(t){var e=t.split(":"),r={key:e[0]};e[1]&&(r.value=e[1]),a.push(r)});var f=o(t,"path")||i.arg&&i.arg.replace(/\$/g,".")||function(t){var r=t.data.directives;if(!t||!e(r))return"";for(var n=r.length-1;n>=0;n--)if("model"===r[n].name)return r[n].expression;return""}(s);S.add(t,a,f,s.context,!!i.modifiers.init,i.value.errorTarget)}return{install:function(e,r){var n;r&&(n=(n=r)||{},t.events=n.events||t.events,t.onSuccess=n.onSuccess||t.onSuccess,t.onError=n.onError||t.onError,t.resultKey=n.resultKey||t.resultKey),e.mixin(k),e.directive("validator",x),e.prototype.$$validator=S}}});